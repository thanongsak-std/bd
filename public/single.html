<!doctype html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body>
    <div class="fixed inset-0 bg-black/[.8] flex items-center justify-center p-4"><img src="" alt="" id="previewImage"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/peerjs/1.4.7/peerjs.min.js"></script>
    <script>
    const peer = new peerjs.Peer()
    const img = document.getElementById('previewImage')

    peer.on('open', () => {
      const [ id, md5 ] = atob(location.hash.substring(1)).split(',')
      
      const dataConnection = peer.connect(id, { reliable: true })
      dataConnection.on('open', () => dataConnection.send('single: '+md5))
      dataConnection.on('data', (data) => {
        if (data.type != 'single') return
        if (data.md5 != md5) return
        const file = new File([data.file], data.fileName)
        img.src = URL.createObjectURL(file)
        img.onclick = (e) => {
          const el = document.createElement('a')
          el.href = img.src
          el.download = data.fileName
          el.click()
        }
      })
    })
    </script>
  </body>
</html>